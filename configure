#!/bin/sh
#
# copyright (c) 2015 Zhang Rui <bbcallen@gmail.com>
#
# This file is part of jni4android.
#
# jni4android is free software; you can redistribute it and/or
# modify it under the terms of the GNU Lesser General Public
# License as published by the Free Software Foundation; either
# version 2.1 of the License, or (at your option) any later version.
#
# jni4android is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# Lesser General Public License for more details.
#
# You should have received a copy of the GNU Lesser General Public
# License along with jni4android; if not, write to the Free Software
# Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA
#/

build_root_dir=`pwd`

die_unknown(){
    echo "Unknown option \"$1\"."
    echo "See $0 --help for available options."
    exit 1
}

show_help(){
    cat <<EOF
Usage: configure [options]
Options: [defaults in brackets after descriptions]

Help options:
  --help                   print this message

Standard options:
  --prefix=PREFIX          install in PREFIX [$prefix]
  --bindir=DIR             install binaries in DIR [PREFIX/bin]
  --incdir=DIR             install includes in DIR [PREFIX/include]

  NOTE: Object files are built at the place where configure is launched.
EOF
  exit 0
}



#----- define options -----
PATHS_LIST="
    bindir
    incdir
    prefix
"

CMDLINE_SET="
    $PATHS_LIST
"



#----- init options -----
opt_prefix_default="output"

for optname in $CMDLINE_SET; do
    eval opt_$optname=
done



#----- parse options -----
for opt do
    optval="${opt#*=}"
    case "$opt" in
        --help|-h)
            show_help
        ;;
        --prefix=*|--bindir=*|--incdir=*)
            optname="${opt%%=*}"
            optname="${optname#--}"
            optname=$(echo "$optname" | sed 's/-/_/g')
            eval opt_$optname='$optval'
        ;;
        *)
            optname="${opt%%=*}"
            optname="${optname#--}"
            optname=$(echo "$optname" | sed 's/-/_/g')
            if is_in $optname $CMDLINE_SET; then
                eval opt_$optname='$optval'
            elif is_in $optname $CMDLINE_APPEND; then
                append opt_$optname "$optval"
            else
                die_unknown $opt
            fi
        ;;
     esac
done



#----- check options -----
if [ "$opt_prefix"="" ]; then
    opt_prefix="$opt_prefix_default"
fi

if [ "opt_bindir"="" ]; then
    opt_bindir="$opt_prefix/bin"
fi

if [ "opt_incdir"="" ]; then
    opt_incdir="$opt_prefix/include"
fi



#----- print evaluated options -----
echo "install prefix:           $opt_prefix"
echo "  binary directory:       $opt_bindir"
echo "  include directory:      $opt_incdir"



#----- output -----
cat > config.mak <<EOF
# Automatically generated by configure - do not modify!
PREFIX=$opt_prefix
BINDIR=$opt_bindir
INCDIR=$opt_incdir
EOF

cat > config.h <<EOF
/* Automatically generated by configure - do not modify! */
EOF
